
{% extends 'base.html' %}
{% block content %}
<!-- Prediction Overview -->
<div class="row mt-4">
  <div class="col-md-6 d-flex justify-content-center">
    <div class="chart-container" style="max-width: 350px; max-height: 300px; margin: 20px auto;">
      <h5 class="text-center">Prediction Overview</h5>
      <div id="noDataMsg" class="text-center text-muted mt-2" style="display:none;">
        No predictions yet
      </div>
      <canvas id="predPie"></canvas>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Prediction Summary</h5>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between">
            <span>Total Students</span> <strong>{{ total }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between text-success">
            <span>Pass</span> <strong>{{ passes }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between text-danger">
            <span>Fail</span> <strong>{{ fails }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Avg Pass Confidence</span> <strong>{{ avg_prob_pass*100 }}%</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Avg Fail Confidence</span> <strong>{{ avg_prob_fail*100 }}%</strong>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function loadStats() {
  try {
    const res = await fetch("/api/stats", { cache: "no-store" });
    const data = await res.json();

    const passes = Number(data.passes || 0);
    const fails = Number(data.fails || 0);

    // Show message if no data
    document.getElementById('noDataMsg').style.display = (passes + fails) === 0 ? 'block' : 'none';

    const ctx = document.getElementById('predPie').getContext('2d');
    if (window.__predChart) window.__predChart.destroy();

    window.__predChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Pass', 'Fail'],
        datasets: [{
          data: [passes, fails],
          backgroundColor: ['#4CAF50', '#F44336']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });
  } catch (e) {
    console.error("Failed to load stats", e);
  }
}

document.addEventListener('DOMContentLoaded', loadStats);
</script>
{% endblock %}
